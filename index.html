<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Quiz Slide</title>
    
    <link rel="stylesheet" href="node_modules/reveal.js/dist/reveal.css">
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div class="reveal">
        <div class="slides">
            <!-- Markdownファイルを読み込む -->
            <section data-markdown="quiz.md"
                     data-separator="^\r?\n---\r?\n"
            >
            </section>
        </div>
    </div>

    <script type="module">
        import Reveal from './node_modules/reveal.js/dist/reveal.esm.js';
        import Markdown from './node_modules/reveal.js/plugin/markdown/markdown.esm.js';
        
        // Reveal.jsを初期化
        Reveal.initialize({
            controls: false,
            progress: false,
            hash: true,
            // 4:3比率の設定
            width: 800, height: 600,
            margin: 0,
            minScale: 1,
            maxScale: 1,
            center: true,
            disableLayout: false,
            transition: 'none',
            // Markdownプラグインを有効化
            plugins: [ Markdown ]
        });

        // カウントダウンタイマーの実装
        function startCountdown() {
            // 既存のタイマーを全て削除
            document.querySelectorAll('.countdown-timer').forEach(timer => timer.remove());
            
            const current = document.querySelector('.present');
            if (!current) return;
            
            const h1Element = current.querySelector('h1');
            if (!h1Element) return;
            
            // タイマー表示用のdiv要素を作成
            const timerElement = document.createElement('div');
            let limit = current.dataset.limit;
            let time = limit ? parseInt(limit) : 10;  //未定義なら10秒
            timerElement.className = 'countdown-timer';
            timerElement.textContent = time;
            current.appendChild(timerElement);
            
            // let time = 10;
            const timer = setInterval(() => {
                time--;
                timerElement.textContent = time;
                // 残り3秒以降演出を加える
                if (time <= 0) {
                    clearInterval(timer);
                }
            }, 1000);
        }

        Reveal.on('slidechanged', (event) => {
            const state = event.currentSlide.dataset.state;
            console.log(state);
            if (state === 'with-timer') {
                startCountdown();
            }
        });
    </script>
</body>
</html>